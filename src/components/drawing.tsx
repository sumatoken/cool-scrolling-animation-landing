import { useEffect, useRef, useState } from 'react';
import { motion, useAnimation, useMotionValue, useMotionValueEvent, useScroll, useTransform } from 'framer-motion';

export default function AnimatedSVG() {
    const ref = useRef(null)
    const { scrollYProgress } = useScroll({
        target: ref
    })
    const y = useMotionValue(0)
    const opacity = useMotionValue(0)

    const pathLength = useTransform(
        scrollYProgress,
        // Map x from these values:
        [0, 1],
        // Into these values:
        [0, 1]
    )
    useMotionValueEvent(pathLength, "change", (latest) => {

        console.log('====================================');
        console.log(latest);
        console.log('====================================');
        // if (y.get() > latest) return
        y.set(latest)
        opacity.set(1)
    })

    return (
        <motion.div ref={ref} className=' h-[200vh]'>

            <motion.svg className='sticky top-0' width="343" height="619" viewBox="0 0 343 619" fill="none" xmlns="http://www.w3.org/2000/svg">
                <motion.path d="M326.286 538.44C318.468 535.972 297.349 528.429 281.851 507.446C268.686 489.617 265.394 471.377 264.434 462.326C261.417 433.937 270.606 411.994 275.68 400.886C283.634 383.743 295.703 371.126 303.246 361.8C316.411 345.754 322.583 340.269 329.851 329.709C335.2 322.029 341.371 309.823 342.331 293.64C343.566 272.932 335.748 257.16 330.674 248.246C321.76 232.474 310.103 223.149 305.714 220.269C295.703 213.549 290.766 211.766 275.543 202.989C250.308 188.451 245.509 185.297 241.669 181.046C238.377 177.343 233.166 167.331 235.223 153.891C236.457 145.663 240.983 137.846 244.96 126.874C248.388 117.686 251.68 109.457 251.954 99.4457C252.229 91.4915 251.406 77.3657 241.257 66.3943C239.886 64.8857 228.503 52.4057 214.926 55.56C200.937 58.7143 196.411 74.76 195.726 77.64C193.943 83.8114 194.354 92.04 195.04 98.0743C196.274 110.28 198.743 115.629 206.286 141.823C209.851 154.029 211.36 160.2 212.457 164.589C215.337 176.52 216.708 184.749 217.257 190.646C217.806 196.269 218.765 205.731 214.377 219.72C212.594 225.343 209.851 234.12 202.446 242.897C194.628 252.223 186.674 257.571 179.543 260.863C165.28 267.583 151.428 269.914 147.314 270.189C135.52 271.011 124.274 269.503 114.674 264.291C112.754 263.194 99.8627 254.691 98.9027 241.389C97.5312 221.914 120.708 208.474 127.428 205.32C150.606 194.211 169.394 195.72 177.348 196.543C188.183 197.777 198.331 199.697 208.343 208.2C221.234 219.309 223.84 235.629 225.623 245.777C226.446 250.577 227.131 259.629 226.994 275.263C226.857 291.309 226.034 298.166 224.8 304.886C223.291 312.566 220.96 323.949 212.457 335.469C209.577 339.446 201.211 350.006 195.04 352.749C189.28 355.354 181.874 357.686 173.234 359.88C163.36 362.349 154.72 364.406 138.948 366.189C122.628 368.109 110.286 367.971 100.96 367.834C82.5827 367.697 71.3369 366.737 53.234 364.543C42.5369 363.309 29.3712 361.114 17.3027 355.629C13.1884 353.846 9.62273 352.2 6.74273 348.634C2.62845 343.423 -0.800059 335.469 3.03994 330.531C4.68566 328.337 5.23429 327.377 7.56572 324.497C10.5829 320.657 12.2284 318.326 12.9142 315.994C13.1884 314.897 13.7369 313.251 13.4626 311.194C13.1883 308.589 12.3656 307.903 11.5427 305.023C10.9942 303.103 10.3084 301.457 10.1713 297.891C10.0342 294.463 10.5826 291.994 11.4055 289.389C12.0912 286.92 13.5998 284.726 13.8741 284.177C14.5598 283.08 14.8342 282.669 16.0685 281.297C20.5942 275.812 20.0456 276.497 21.1427 275.4C24.0227 272.246 25.5312 270.874 26.4912 270.051C30.8797 266.486 35.4056 266.897 39.657 268.543C41.1656 269.091 42.5372 269.777 45.28 271.56C48.7086 273.754 49.2569 274.029 51.8626 275.537C54.8797 277.32 60.2284 280.749 59.817 281.709C59.4055 282.531 55.4283 280.337 48.434 279.24C41.3026 278.143 34.0341 276.909 26.217 279.377C24.297 280.063 22.1027 280.886 19.7713 280.063C17.3027 279.103 15.9312 276.497 14.5598 273.617C12.6398 269.366 12.2283 265.8 12.0912 263.743C11.8169 259.629 11.6799 256.474 13.5999 254.28C15.5199 252.36 17.7142 252.771 20.8685 250.989C24.7085 248.794 25.6684 245.366 26.9027 242.211C27.7255 239.88 30.0572 233.571 27.4514 227.4C26.6286 225.343 23.7486 222.326 20.5943 218.76C14.6972 212.177 13.1883 209.16 12.7769 207.377C11.8169 203.949 12.2286 199.149 15.1086 195.171C17.9886 191.194 24.4342 189.274 27.3142 188.451C27.3142 188.451 40.7543 185.023 60.3657 174.6C64.6172 172.269 71.0627 168.429 78.057 162.12" stroke="white" strokeMiterlimit="10" strokeLinecap="round" strokeLinejoin="round"
                    style={{
                        pathLength,
                        opacity
                    }}
                    initial={{
                        opacity: 0
                    }}

                />
            </motion.svg>
        </motion.div>
    );
}
